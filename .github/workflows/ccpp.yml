name: C/C++ CI

on: [push, pull_request]
jobs:
  test_repair:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    steps:
    - uses: actions/checkout@v1

    - name: build
      run:  scripts/build_ci.bash

    - name: run check
      run: bats ./test/functional/repair

    - name: print status
      if: failure()
      run: cat test-suite.log

  test_repair_old:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    steps:
    - uses: actions/checkout@v1

    - name: build
      run:  scripts/build_ci.bash

    - name: run prereq
      run:  test/functional/generate-cert.prereq

    - name: run check
      run: bats ./test/functional/repair_old

    - name: print status
      if: failure()
      run: cat test-suite.log
